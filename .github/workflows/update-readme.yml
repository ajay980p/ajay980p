name: Update README with Experience Duration

on:
  schedule:
    - cron: "0 0 * * *" # Runs daily at midnight UTC
  workflow_dispatch: # Allows manual triggering

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "14"

      - name: Create update-experience.js script
        run: |
          cat << 'EOF' > update-experience.js
          const fs = require('fs');

          const startDate = new Date('2022-08-01');  // Replace with your actual start date
          const currentDate = new Date();

          let totalMonths = (currentDate.getFullYear() - startDate.getFullYear()) * 12;
          totalMonths += currentDate.getMonth() - startDate.getMonth();

          if (currentDate.getDate() < startDate.getDate()) {
            totalMonths--;
          }

          const years = Math.floor(totalMonths / 12);
          const months = totalMonths % 12;

          const experienceText = `${years} years and ${months} months`;

          let readmeContent = fs.readFileSync('README.md', 'utf8');
          readmeContent = readmeContent.replace(/<!-- EXPERIENCE_PLACEHOLDER -->/g, experienceText);

          fs.writeFileSync('README.md', readmeContent);
          EOF

      - name: Run update-experience.js
        run: node update-experience.js

      - name: Commit Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "Update experience duration in README [skip ci]" || exit 0
          git push
